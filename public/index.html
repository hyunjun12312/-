<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Territory.io v5 — Ultimate Strategy</title>
  <link rel="stylesheet" href="style.css">
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <canvas id="gameCanvas"></canvas>

  <!-- Start Screen (Discord Login only) -->
  <div id="ss" class="screen">
    <div class="login-box">
      <h1>🏰 Territory.io</h1>
      <p class="subtitle">전략적 영토 정복 게임</p>
      <div id="loginSection">
        <p class="login-hint">디스코드로 로그인하면 진행내역이 저장됩니다</p>
        <a href="/auth/discord" class="btn btn-discord">👾 Discord로 로그인</a>
      </div>
    </div>
  </div>

  <!-- Lobby Screen -->
  <div id="lobbyScreen" class="screen" style="display:none">
    <div class="lobby-container">
      <h1 class="lobby-title">🏰 Territory.io</h1>
      <div class="lobby-main">
        <div class="lobby-map-section">
          <div class="lobby-badge-row">
            <span class="lobby-mode-badge">개인전</span>
            <span class="lobby-timer-badge" id="lobbyTimer">45s</span>
          </div>
          <canvas id="lobbyMapPreview" width="400" height="200"></canvas>
          <div class="lobby-map-info">
            <div class="lobby-map-left">
              <span class="lobby-map-label">다음 게임 참가</span>
              <span class="lobby-map-name" id="lobbyMapName">리스본</span>
            </div>
            <span class="lobby-player-count" id="lobbyPlayerCount">0/20 👥</span>
          </div>
        </div>
        <div class="lobby-side">
          <div id="lobbyUserInfo" class="lobby-user-info"></div>
          <div class="lobby-civ-section">
            <h3>문명 선택</h3>
            <div id="lobbyCivGrid" class="civ-grid"></div>
            <div id="lobbyCivDesc" class="civ-desc">문명을 선택하세요</div>
          </div>
          <button id="lobbyJoinBtn" onclick="joinLobby()" class="btn btn-gold lobby-join-btn">🎮 참가</button>
          <div class="lobby-players-section">
            <h4>참가자</h4>
            <div id="lobbyPlayersList" class="lobby-players-list"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Death Screen -->
  <div id="ds" class="screen" style="display:none">
    <div class="login-box">
      <h2>💀 멸망</h2>
      <p>영토를 모두 잃었습니다!</p>
      <div id="deathStats" class="death-stats"></div>
      <p class="death-hint">다음 라운드가 시작되면 자동으로 로비로 돌아갑니다</p>
      <button onclick="respawnMidGame()" class="btn btn-gold">즉시 부활</button>
    </div>
  </div>

  <!-- Game UI -->
  <div id="gu" style="display:none">
    <!-- Connection Status -->
    <div id="connStatus" class="conn-status connected">
      <span class="conn-dot"></span>
      <span class="conn-text">연결됨</span>
    </div>

    <!-- Round Timer -->
    <div id="roundTimer" class="round-timer"></div>

    <!-- Top Bar -->
    <div id="topBar">
      <span id="rankBadge" class="rank-badge"></span>
      <span id="civBadge" class="civ-badge"></span>
      <div class="res-group troop-res">
        <span id="rTroop" class="troop-highlight">⚔️ 0/0</span>
      </div>
      <div class="res-group" data-res="food">
        <span id="rFood">🌾 0</span>
        <span id="rFoodRate" class="res-rate"></span>
      </div>
      <div class="res-group" data-res="wood">
        <span id="rWood">🪵 0</span>
        <span id="rWoodRate" class="res-rate"></span>
      </div>
      <div class="res-group" data-res="stone">
        <span id="rStone">🪨 0</span>
        <span id="rStoneRate" class="res-rate"></span>
      </div>
      <div class="res-group" data-res="gold">
        <span id="rGold">💰 0</span>
        <span id="rGoldRate" class="res-rate"></span>
      </div>
    </div>

    <!-- Shield / Streak / Protection indicators -->
    <div id="shieldIndicator" class="shield-indicator" style="display:none"></div>
    <div id="streakHud" class="streak-hud" style="display:none"></div>
    <div id="strategicBonuses" class="strategic-bonuses"></div>
    <div id="protTimer" class="prot-timer" style="display:none"></div>

    <!-- Side Panel -->
    <div id="sidePanel">
      <button id="sidePanelToggle" class="side-panel-toggle" onclick="toggleSidePanel()">◀</button>
      <div class="tab-bar">
        <button class="tab-btn active" data-tab="lbTab" onclick="switchTab('lbTab')" title="순위">👑<span class="tab-label">순위</span></button>
        <button class="tab-btn" data-tab="bldTab" onclick="switchTab('bldTab')" title="건물">🏗️<span class="tab-label">건물</span></button>
        <button class="tab-btn" data-tab="techTab" onclick="switchTab('techTab')" title="기술">🔬<span class="tab-label">기술</span></button>
        <button class="tab-btn" data-tab="questTab" onclick="switchTab('questTab')" title="퀘스트">📜<span class="tab-label">퀘스트</span></button>
        <button class="tab-btn" data-tab="tradeTab" onclick="switchTab('tradeTab')" title="교역">🤝<span class="tab-label">교역</span></button>
        <button class="tab-btn" data-tab="clanTab" onclick="switchTab('clanTab')" title="클랜">🏴<span class="tab-label">클랜</span></button>
      </div>

      <div class="tab-content-wrapper">
        <!-- Leaderboard Tab -->
        <div id="lbTab" class="tab-content active">
          <div id="plb"></div>
          <div id="clb"></div>
        </div>

        <!-- Buildings Tab -->
        <div id="bldTab" class="tab-content">
          <div id="bldList"></div>
        </div>

        <!-- Tech Tab -->
        <div id="techTab" class="tab-content">
          <div id="techList"></div>
        </div>

        <!-- Quest Tab -->
        <div id="questTab" class="tab-content">
          <div id="questStreak" class="quest-streak"></div>
          <div id="questList"></div>
        </div>

        <!-- Trade Tab -->
        <div id="tradeTab" class="tab-content">
          <div class="trade-panel">
            <h3>자원 교환</h3>
            <div class="trade-row">
              <select id="tradeFrom">
                <option value="food">식량</option>
                <option value="wood">목재</option>
                <option value="stone">석재</option>
                <option value="gold">골드</option>
              </select>
              <span>→</span>
              <select id="tradeTo">
                <option value="wood">목재</option>
                <option value="food">식량</option>
                <option value="stone">석재</option>
                <option value="gold">골드</option>
              </select>
            </div>
            <input id="tradeAmount" type="number" value="100" min="10" max="10000" placeholder="수량">
            <div id="tradeRate" class="trade-rate"></div>
            <button onclick="doTrade()" class="btn">교환</button>
          </div>
        </div>

        <!-- Clan Tab -->
        <div id="clanTab" class="tab-content">
          <div id="clanPanel"></div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button onclick="doBorderPush()" class="btn btn-blue" title="B키">🏴 영토 확장<span class="hotkey-badge">B</span></button>
        <button onclick="startMassAtk()" class="btn btn-red" title="M키">⚔️ 대규모 공격<span class="hotkey-badge">M</span></button>
      </div>

      <!-- Unit Deployment -->
      <div class="unit-panel">
        <div class="unit-panel-header">
          <span>🎖️ 유닛 배치</span>
          <span id="unitCount" class="unit-count">0/5</span>
        </div>
        <div class="unit-buttons">
          <button onclick="deployUnit('scout')" class="btn btn-unit btn-scout" title="정찰대 (5)">
            <span class="unit-icon">🔭</span>
            <span class="unit-label">정찰대</span>
            <span class="unit-cost">⚔️5</span>
            <span class="unit-key">5</span>
          </button>
          <button onclick="deployUnit('army')" class="btn btn-unit btn-army" title="원정군 (6)">
            <span class="unit-icon">⚔️</span>
            <span class="unit-label">원정군</span>
            <span class="unit-cost">⚔️20</span>
            <span class="unit-key">6</span>
          </button>
          <button onclick="deployUnit('elite')" class="btn btn-unit btn-elite" title="정예군 (7)">
            <span class="unit-icon">🛡️</span>
            <span class="unit-label">정예군</span>
            <span class="unit-cost">⚔️50</span>
            <span class="unit-key">7</span>
          </button>
        </div>
        <div id="activeUnitsList" class="active-units-list"></div>
      </div>
    </div>

    <!-- Quick Action Bar -->
    <div id="quickBar" class="quick-bar">
      <button onclick="centerOnCapital()" class="qbar-btn" title="수도로 이동 (H)">🏰<span class="qbar-key">H</span></button>
      <button onclick="toggleMinimap()" class="qbar-btn" title="미니맵 토글 (Tab)">🗺️</button>
      <button id="qbarZoomIn" class="qbar-btn" title="확대 (+)">🔍+</button>
      <button id="qbarZoomOut" class="qbar-btn" title="축소 (-)">🔍-</button>
    </div>

    <!-- Minimap Container -->
    <div id="minimapContainer" class="minimap-container">
      <canvas id="minimap" width="300" height="150"></canvas>
      <div class="minimap-header">
        <span class="minimap-title">미니맵</span>
        <button class="minimap-close" onclick="toggleMinimap()">✕</button>
      </div>
    </div>
    <div id="coordHud"></div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Notifications -->
    <div id="msgBox" class="msg-box" style="display:none"></div>
    <div id="rewardBox" class="reward-box" style="display:none"></div>
    <div id="streakNotif" class="streak-notif" style="display:none"></div>
    <div id="questDoneNotif" class="quest-done-notif" style="display:none"></div>

    <!-- Keyboard Shortcuts Help -->
    <div id="shortcutHelp" class="shortcut-help" style="display:none">
      <div class="shortcut-title">⌨️ 단축키</div>
      <div class="shortcut-grid">
        <div class="sc-item"><kbd>W/↑</kbd> 위</div>
        <div class="sc-item"><kbd>A/←</kbd> 왼쪽</div>
        <div class="sc-item"><kbd>S/↓</kbd> 아래</div>
        <div class="sc-item"><kbd>D/→</kbd> 오른쪽</div>
        <div class="sc-item"><kbd>H</kbd> 수도 이동</div>
        <div class="sc-item"><kbd>B</kbd> 영토 확장</div>
        <div class="sc-item"><kbd>M</kbd> 대규모 공격</div>
        <div class="sc-item"><kbd>5</kbd> 정찰대</div>
        <div class="sc-item"><kbd>6</kbd> 원정군</div>
        <div class="sc-item"><kbd>7</kbd> 정예군</div>
        <div class="sc-item"><kbd>P</kbd> 패널 토글</div>
        <div class="sc-item"><kbd>ESC</kbd> 취소</div>
      </div>
    </div>
  </div>

  <!-- Spy Modal -->
  <div id="spyModal" class="modal" style="display:none">
    <div class="modal-content">
      <div class="modal-header">
        <h3>🕵️ 첩보 정보</h3>
        <button onclick="closeSpyModal()" class="close-btn">✕</button>
      </div>
      <div id="spyInfo"></div>
    </div>
  </div>

  <script src="game.js"></script>
</body>
</html>
