<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Territory.io v5</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <canvas id="gameCanvas"></canvas>

  <!-- Login Screen -->
  <div id="loginScreen" class="screen">
    <div class="login-box">
      <h1>🏰 Territory.io</h1>
      <div id="discordUserInfo" style="display:none" class="discord-user">
        <img class="discord-avatar" src="" alt="avatar">
        <span class="discord-name"></span>
        <button class="discord-logout" onclick="location.href='/auth/logout'">로그아웃</button>
      </div>
      <a id="discordLoginBtn" href="/auth/discord" class="discord-btn" style="display:none">
        <svg width="20" height="20" viewBox="0 0 71 55" fill="white"><path d="M60.1 4.9A58.5 58.5 0 0045.4.2a.2.2 0 00-.2.1 41 41 0 00-1.8 3.7 54 54 0 00-16.2 0A40 40 0 0025.4.3a.2.2 0 00-.2-.1A58.4 58.4 0 0010.5 4.9a.2.2 0 00-.1.1C1.5 18.7-.9 32.2.3 45.5v.2a58.9 58.9 0 0017.7 9a.2.2 0 00.3-.1 42 42 0 003.6-5.9.2.2 0 00-.1-.3 38.8 38.8 0 01-5.5-2.7.2.2 0 01 0-.4l1.1-.9a.2.2 0 01.2 0 42 42 0 0035.6 0 .2.2 0 01.2 0l1.1.9a.2.2 0 010 .4 36.4 36.4 0 01-5.5 2.7.2.2 0 00-.1.3 47.2 47.2 0 003.6 5.9.2.2 0 00.3.1A58.7 58.7 0 0070.5 45.7v-.2c1.4-15-2.3-28.4-9.8-40.1a.2.2 0 00-.1-.1zM23.7 37.3c-3.5 0-6.3-3.2-6.3-7s2.8-7 6.3-7 6.4 3.2 6.3 7-2.8 7-6.3 7zm23.3 0c-3.5 0-6.3-3.2-6.3-7s2.8-7 6.3-7 6.4 3.2 6.3 7-2.8 7-6.3 7z"/></svg>
        Discord 로그인
      </a>
      <input id="nameInput" type="text" placeholder="이름 입력" maxlength="20">
      <div style="display:flex;gap:10px;justify-content:center;margin-top:10px">
        <button onclick="quickSpawn()" class="btn">빠른 시작</button>
        <button onclick="showSpawnSelect()" class="btn btn-gold">위치 선택</button>
      </div>
    </div>
  </div>

  <!-- Spawn Screen -->
  <div id="spawnScreen" class="spawn-overlay" style="display:none">
    <div class="spawn-container">
      <h2>스폰 위치 선택</h2>
      <p>지도를 클릭하여 시작 위치를 선택하세요</p>
      <div class="spawn-map-wrap">
        <canvas id="spawnMapCanvas" width="400" height="200" onclick="handleSpawnMapClick(event)"></canvas>
      </div>
      <div id="spawnCoords" style="color:#ffd700;margin:5px 0">좌표: 미선택</div>
      <div style="display:flex;gap:10px;justify-content:center">
        <button onclick="confirmSpawn()" class="btn btn-gold">확인</button>
        <button onclick="document.getElementById('spawnScreen').style.display='none';spawnMode=false;" class="btn">취소</button>
      </div>
    </div>
  </div>

  <!-- Respawn Screen -->
  <div id="respawnScreen" class="spawn-overlay" style="display:none">
    <div class="spawn-container">
      <h2>리스폰 위치 선택</h2>
      <p>지도를 클릭하여 리스폰 위치를 선택하세요</p>
      <div class="spawn-map-wrap">
        <canvas id="respawnMapCanvas" width="400" height="200" onclick="handleRespawnMapClick(event)"></canvas>
      </div>
      <div id="respawnCoords" style="color:#ffd700;margin:5px 0">좌표: 미선택</div>
      <div style="display:flex;gap:10px;justify-content:center">
        <button onclick="confirmRespawn()" class="btn btn-gold">확인</button>
        <button onclick="document.getElementById('respawnScreen').style.display='none';spawnMode=false;" class="btn">취소</button>
      </div>
    </div>
  </div>

  <!-- Death Screen -->
  <div id="deathScreen" class="screen" style="display:none">
    <div class="login-box">
      <h2>💀 멸망</h2>
      <p>영토를 모두 잃었습니다!</p>
      <div style="display:flex;gap:10px;justify-content:center;margin-top:10px">
        <button onclick="quickRespawn()" class="btn">빠른 리스폰</button>
        <button onclick="showRespawnSelect()" class="btn btn-gold">위치 선택</button>
      </div>
    </div>
  </div>

  <!-- Game UI -->
  <div id="ui" style="display:none">
    <!-- Top bar -->
    <div id="topBar">
      <div id="resBar">
        <span>🌾 <span id="resFood">0</span></span>
        <span>🪵 <span id="resWood">0</span></span>
        <span>🪨 <span id="resStone">0</span></span>
        <span>💰 <span id="resGold">0</span></span>
      </div>
      <div id="apDisplay">AP: 0/0</div>
      <div id="troopDisplay">병력: 0/0</div>
      <div id="protectionDisplay" style="display:none;color:#0ff">보호막: 0분</div>
      <div id="discordNameDisplay" style="color:#7289da;font-size:12px"></div>
    </div>

    <!-- Side buttons -->
    <div id="sideButtons">
      <button onclick="openBuildPanel()" class="btn-sm">🏗️ 건설</button>
      <button onclick="openClanPanel()" class="btn-sm">⚔️ 클랜</button>
      <button onclick="toggleHelp()" class="btn-sm">❓ 도움</button>
    </div>

    <!-- Leaderboard -->
    <div id="leaderboard">
      <div style="font-weight:bold;color:#ffd700;margin-bottom:4px">🏆 순위</div>
      <div id="lbList"></div>
    </div>

    <!-- Minimap -->
    <canvas id="minimap" width="300" height="150"></canvas>

    <!-- Build Panel -->
    <div id="buildPanel" class="panel" style="display:none">
      <button onclick="document.getElementById('buildPanel').style.display='none'" style="float:right">✕</button>
      <div id="buildContent"></div>
    </div>

    <!-- Clan Panel -->
    <div id="clanPanel" class="panel" style="display:none">
      <button onclick="document.getElementById('clanPanel').style.display='none'" style="float:right">✕</button>
      <div id="clanContent"></div>
    </div>

    <!-- Help Panel -->
    <div id="helpPanel" class="panel" style="display:none">
      <button onclick="toggleHelp()" style="float:right">✕</button>
      <h3>도움말</h3>
      <ul>
        <li><b>클릭</b>: 영토 확장 (AP 소모)</li>
        <li><b>Shift+클릭</b>: 대규모 공격 (AP 절반 소모)</li>
        <li><b>B</b>: 국경 밀기 (AP 20% 소모)</li>
        <li><b>+/-</b>: 브러시 크기 조절</li>
        <li><b>C</b>: 수도로 이동</li>
        <li><b>마우스 휠</b>: 줌</li>
        <li><b>드래그</b>: 화면 이동</li>
        <li>시작 후 <b>2시간</b> 보호막 적용</li>
        <li><b>야만인 캠프</b>를 점령하면 보상 획득</li>
        <li>오프라인 시 최대 <b>8시간</b> 자원·병력 누적</li>
        <li>적 수도 점령 시 자원 <b>약탈</b> + 킬 보너스</li>
      </ul>
    </div>

    <!-- Message -->
    <div id="messageBox"></div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script src="game.js"></script>
</body>
</html>
