<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Territory.io v5 — Ultimate Strategy</title>
  <link rel="stylesheet" href="style.css">
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <canvas id="gameCanvas"></canvas>

  <!-- Start Screen -->
  <div id="ss" class="screen">
    <div class="login-box">
      <h1>🏰 Territory.io</h1>
      <p class="subtitle">전략적 영토 정복 게임</p>
      <!-- Discord Login Section -->
      <div id="loginSection">
        <p class="login-hint">디스코드로 로그인하면 진행내역이 저장됩니다</p>
        <a href="/auth/discord" class="btn btn-discord">👾 Discord로 로그인</a>
      </div>
      <!-- After Login Section (hidden until authenticated) -->
      <div id="afterLogin" style="display:none">
        <div id="discordUser" class="discord-user"></div>
        <div class="civ-section">
          <h3>문명 선택</h3>
          <div id="civGrid" class="civ-grid"></div>
          <div id="civDesc" class="civ-desc">문명을 선택하세요</div>
        </div>
        <div class="spawn-section">
          <h3>🗺️ 시작 위치 선택</h3>
          <p class="spawn-hint">지도를 클릭하여 시작 위치를 선택하세요 (바다 제외)</p>
          <div class="spawn-map-wrap">
            <canvas id="spawnMap" width="300" height="150"></canvas>
            <div id="spawnMarker" class="spawn-marker" style="display:none">✦</div>
          </div>
          <p id="spawnCoordText" class="spawn-coord">위치: 랜덤</p>
        </div>
        <button onclick="startGame()" class="btn btn-gold">게임 시작</button>
        <a href="/auth/logout" class="logout-link">로그아웃</a>
      </div>
    </div>
  </div>

  <!-- Death Screen -->
  <div id="ds" class="screen" style="display:none">
    <div class="login-box">
      <h2>💀 멸망</h2>
      <p>영토를 모두 잃었습니다!</p>
      <div id="deathStats" class="death-stats"></div>
      <div class="civ-section small">
        <h3>문명 재선택</h3>
        <div id="respawnCivGrid" class="civ-grid small"></div>
      </div>
      <div class="spawn-section">
        <h3>🗺️ 부활 위치 선택</h3>
        <p class="spawn-hint">지도를 클릭하여 부활 위치를 선택하세요</p>
        <div class="spawn-map-wrap">
          <canvas id="respawnMap" width="300" height="150"></canvas>
          <div id="respawnMarker" class="spawn-marker" style="display:none">✦</div>
        </div>
        <p id="respawnCoordText" class="spawn-coord">위치: 랜덤</p>
      </div>
      <button onclick="respawn()" class="btn btn-gold">다시 시작</button>
    </div>
  </div>

  <!-- Game UI -->
  <div id="gu" style="display:none">
    <!-- Top Bar -->
    <div id="topBar">
      <span id="rankBadge" class="rank-badge"></span>
      <span id="civBadge" class="civ-badge"></span>
      <span id="rFood">🌾 0</span>
      <span id="rWood">🪵 0</span>
      <span id="rStone">🪨 0</span>
      <span id="rGold">💰 0</span>
      <span id="rAP">⚡ 0/0</span>
      <span id="rTroop">🗡️ 0/0</span>
    </div>

    <!-- Shield / Streak / Protection indicators -->
    <div id="shieldIndicator" class="shield-indicator" style="display:none"></div>
    <div id="streakHud" class="streak-hud" style="display:none"></div>
    <div id="protTimer" class="prot-timer" style="display:none"></div>

    <!-- Skill Bar -->
    <div id="skillBar">
      <button class="skill-btn" data-skill="lightning" onclick="useSkill('lightning')" title="번개 (1)">
        <span class="skill-icon">⚡</span><span class="skill-key">1</span>
        <div class="skill-cd-overlay"></div>
      </button>
      <button class="skill-btn" data-skill="shield" onclick="useSkill('shield')" title="방패 (2)">
        <span class="skill-icon">🛡️</span><span class="skill-key">2</span>
        <div class="skill-cd-overlay"></div>
      </button>
      <button class="skill-btn" data-skill="conscript" onclick="useSkill('conscript')" title="징집 (3)">
        <span class="skill-icon">📯</span><span class="skill-key">3</span>
        <div class="skill-cd-overlay"></div>
      </button>
      <button class="skill-btn" data-skill="plunder" onclick="useSkill('plunder')" title="약탈 (4)">
        <span class="skill-icon">💰</span><span class="skill-key">4</span>
        <div class="skill-cd-overlay"></div>
      </button>
    </div>

    <!-- Side Panel -->
    <div id="sidePanel">
      <div class="tab-bar">
        <button class="tab-btn active" data-tab="lbTab" onclick="switchTab('lbTab')">순위</button>
        <button class="tab-btn" data-tab="bldTab" onclick="switchTab('bldTab')">건물</button>
        <button class="tab-btn" data-tab="techTab" onclick="switchTab('techTab')">기술</button>
        <button class="tab-btn" data-tab="questTab" onclick="switchTab('questTab')">퀘스트</button>
        <button class="tab-btn" data-tab="tradeTab" onclick="switchTab('tradeTab')">교역</button>
        <button class="tab-btn" data-tab="clanTab" onclick="switchTab('clanTab')">클랜</button>
      </div>

      <!-- Leaderboard Tab -->
      <div id="lbTab" class="tab-content active">
        <div id="plb"></div>
        <div id="clb"></div>
      </div>

      <!-- Buildings Tab -->
      <div id="bldTab" class="tab-content">
        <div id="bldList"></div>
      </div>

      <!-- Tech Tab -->
      <div id="techTab" class="tab-content">
        <div id="techList"></div>
      </div>

      <!-- Quest Tab -->
      <div id="questTab" class="tab-content">
        <div id="questStreak" class="quest-streak"></div>
        <div id="questList"></div>
      </div>

      <!-- Trade Tab -->
      <div id="tradeTab" class="tab-content">
        <div class="trade-panel">
          <h3>자원 교환</h3>
          <div class="trade-row">
            <select id="tradeFrom">
              <option value="food">식량</option>
              <option value="wood">목재</option>
              <option value="stone">석재</option>
              <option value="gold">골드</option>
            </select>
            <span>→</span>
            <select id="tradeTo">
              <option value="wood">목재</option>
              <option value="food">식량</option>
              <option value="stone">석재</option>
              <option value="gold">골드</option>
            </select>
          </div>
          <input id="tradeAmount" type="number" value="100" min="10" max="10000" placeholder="수량">
          <div id="tradeRate" class="trade-rate"></div>
          <button onclick="doTrade()" class="btn">교환</button>
        </div>
      </div>

      <!-- Clan Tab -->
      <div id="clanTab" class="tab-content">
        <div id="clanPanel"></div>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button onclick="doBorderPush()" class="btn btn-blue">🏴 영토 확장</button>
        <button onclick="startMassAtk()" class="btn btn-red">⚔️ 대규모 공격</button>
      </div>
    </div>

    <!-- Minimap -->
    <canvas id="minimap" width="300" height="150"></canvas>

    <!-- Notifications -->
    <div id="msgBox" class="msg-box" style="display:none"></div>
    <div id="rewardBox" class="reward-box" style="display:none"></div>
    <div id="comboNotif" class="combo-notif" style="display:none"></div>
    <div id="streakNotif" class="streak-notif" style="display:none"></div>
    <div id="questDoneNotif" class="quest-done-notif" style="display:none"></div>
  </div>

  <!-- Spy Modal -->
  <div id="spyModal" class="modal" style="display:none">
    <div class="modal-content">
      <div class="modal-header">
        <h3>🕵️ 첩보 정보</h3>
        <button onclick="closeSpyModal()" class="close-btn">✕</button>
      </div>
      <div id="spyInfo"></div>
    </div>
  </div>

  <script src="game.js"></script>
</body>
</html>
